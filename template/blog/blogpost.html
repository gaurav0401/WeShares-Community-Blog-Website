{% extends 'base.html' %}
{% load humanize %}
{% load get_dict %}
{% block title %}BlogPost{% endblock title %}


{% block blogactive %} active{% endblock blogactive %}
{% block js %}
   <script>
    let previews= document.getElementByClassName('preview');
    Array.from(previews).forEach((element)=>{
        element.innerHTML = element.innerText;
    })
</script>
{% endblock js %}
{% block body %}


<div class="container my-4">

    <div class="card">



        <div class="col p-4 d-flex flex-column position-static">

            <h2 class="mb-0">{{userpost.title}}</h2>


            <div class="mb-1 mt-1 text-muted"> Published by <a href="/about"
                    style="font-weight: 500;">{{userpost.author}} </a> on {{userpost.date}}  <span> &nbsp; <i class="fa fa-eye" style="font-size: 13px;"></i> {{userpost.views}} views</span></div>
            <p class="mb-auto py-4"><div class="preview">{{userpost.content | safe}}</div></p>

            <div class="mb-2 mt-5">

                {% if user.get_username == userpost.user.username %}
                <a href="deleteblog/{{userpost.sno}}" class="btn btn-danger btn-sm px-4">Delete This Article</a>
                {% endif %}

            </div>

        </div>

    </div>


</div>





<div class="container mt-2">
    <h2>Comments({{total}})</h2>
    <form action="/blog/postcomment" method="post">
        {% csrf_token %}

        <div class="form-floating">
            <textarea class="form-control" name="comment" placeholder="Leave a comment here" id="floatingTextarea2"
                style="height: 100px"></textarea>
            <label for="floatingTextarea2">Leave a comment here</label>
        </div>

        <input type="hidden" name="postsno" value="{{userpost.sno}}">
        <input type="hidden" name="parentsno" value="">
        <button type="submit" class="btn btn-success mt-4">Post Comment</button>

    </form>


    <div class="row my-3">
        <h5 class="mt-2 mb-5">Recent Comments</h5>
        <br><br>

        {% if total == 0 %}

        <p> No comments </p>

        {% endif %}
        {% for comment in comments %}

        <div class="container">
            <div class="col-md-11  mb-4 mx-1 p-2   w-75" style="background-color: white; ">
                <img class="rounded-circle    p-2 border border-dark mt-1" src="\static\pro.png" width="35px"
                    alt="no image">
                <b
                    style="font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; font-weight: 500;">{{comment.user.username}}
                    .</b>
                <small style="color: rgb(115, 115, 115); font-size: 13px;">{{comment.timestamp |naturaltime}} </small>
                <br>
                <div class="mx-5"
                    style="font-weight: 400; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 19px;">
                    {{comment.comment}}</div>

                <p class="mx-5 mt-2 ">
                    <a style="text-decoration: none;  font-weight: 500; font-size: 15px; color: rgb(6, 91, 10);  cursor: pointer;;"
                        data-bs-toggle="collapse" data-bs-target="#collapseExample{{comment.sno}}" aria-expanded="false"
                        aria-controls="collapseExample{{comment.sno}}">
                        Reply
                    </a>

                </p>



                <div class="collapse" id="collapseExample{{comment.sno}}">
                    <form action="/blog/postcomment" method="post">
                        {% csrf_token %}
                        <div class="mb-3 mx-5">

                            <input type="text" name="comment" class="form-control" id="reply"
                                placeholder="Enter your reply" class="rounded-pill">
                            <input type="hidden" name="parentsno" value="{{comment.sno}}">
                            <input type="hidden" name="postsno" value="{{userpost.sno}}">
                            <button type="submit" class="btn btn-success mt-4 ">Post Reply</button>
                        </div>
                    </form>
                </div>

                <div class="replies  mx-5">

                    {% for reply in repdict|get_val:comment.sno %}

                    <span style="margin-bottom: 2px;">
                    
                        <big style="font-weight: 500; font-size: 16px; margin-left:20px;">@{{reply.user.get_username}} </big> 
                    <small style="color: rgb(115, 115, 115); font-size: 13px;">{{reply.timestamp | naturaltime}} </small>
                     <br>
                    <small style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight:400; font-size: 18px; margin-left: 45px; margin-top: 4px; ">  {{reply.comment}}</small>
                </span>
                    <br>

                    {% endfor %}
                </div>



            </div>



        </div>

        {% endfor %}
    </div>
</div>

    {% endblock body %}